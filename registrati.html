<!DOCTYPE html>
<html lang="it">
  <head>
    <meta charset="utf-8" />
    <title>Registrati</title>
    <link rel="icon" href="resources/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"><!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" title="stylesheet" href="style.css">
    <link rel="stylesheet" type="text/css" title="stylesheet" href="./resources/JquerySteps/mysteps.css">
    <link rel="stylesheet" type="text/css" title="stylesheet" href="./css/map.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./resources/JquerySteps/jquery.steps.js"></script>
    <script src="./resources/JquerySteps/jquery.validate.js"></script>
    <script type="text/javascript" src="./js/sha512.js"></script>
    <script type="text/javascript" src="./js/forms.js"></script>
    <script>
      function displayFunction() {
          var x = document.getElementById("pagamento").value;
          var y = document.getElementById("daticc");
          if (x === "cc") {
              y.style.display = "block";
          } else {
              y.style.display = "none";
          }
      }
    </script>
  </head>

  <body>
    <header>
      <a href="home.html">
      <h1>Yook!</h1>
      </a>
      <h2>Make it Yours.</h2>
    </header>

    <form id="form" name="form" action="registrati.php" method="post" onsubmit="return false;">

      <h3>Account</h3>
  		<fieldset><legend>Dati anagrafici:</legend>
  		  <p><label for="name"> Nome *:
          <input type="text" name="nome" id="name" autofocus required/></label></p>
  			<p><label for="sname"> Cognome *:
          <input type="text" name="cognome" id="sname" maxlength="10" required/></label></p>
        <p><label for="mail"> E-Mail *:
          <input type="email" name="mail" id="mail" required/></label></p>
        <p>(*) Obbligatori</p>
      </fieldset>

      <h3>Password</h3>
      <fieldset><legend>Inserisci Password:</legend>
        <p><label for="pw"> Password *:
          <input type="password" name="password" id="pw" maxlength="20" required/></label></p>
        <p><label for="confirm">Conferma password *:
          <input type="password" name="confirm" id="confirm" maxlength="20" required/></label></p>
        <p><label for="age">Age *</label>
          <input id="age" type="number" class="required number" maxlength="3"></p>
        <p>(*) Obbligatori</p>
        <p><label for="mtr"> Numero di matricola **:
          <input type="number" name="numeroMat" id="mtr" maxlength="10"/></label></p>
        <p>(**) Opzionale sconto studenti!</p>
  		</fieldset>

      <h3>Età</h3>
      <fieldset><legend>ATTENZIONE: La tua età deve essere maggiore di 18</legend>
          <p>Non puoi registrarti se sei sotto il limite legale di legge, vedi i <a href="./info_legali.html">Termini e Condizioni.</a>.
              <br/>Per piacere chiedi a un maggiorenne di registrarsi per te.</p>
      </fieldset>

      <h3>Indirizzo</h3>
  		<fieldset><legend>Dati di recapito:</legend>
        <p><label for="indir"> Indirizzo *:
          </label></p>
        <p>(*) Obbligatori</p>
        <div class="pac-card" id="pac-card">
          <div id="pac-container">
            <input id="indir" name="indirizzo" type="text"
                placeholder="Enter a location" onsubmit="#next" required />
          </div>
        </div>
      </fieldset>

      <h3>Pagamento</h3>
      <fieldset><legend>Dati di pagamento:</legend>
        <label for="pagamento"> Tipo pagamento:
          <select name="pagamento" id="pagamento"  onchange="displayFunction()">
            <option value="consegna">Contanti alla consegna</option>
            <option value="cc">Carta di credito</option>
          </select>
        </label>
        <!-- lo script provvederà a cambiare la proprietà display se l'utente seleziona la carta-->
        <div id="daticc" style="display: none;">
        <p><label for="ncarta"> Numero Carta:
          <input type="number" name="numeroCarta" id="ncarta" value="0000000000000000" maxlength="16" required/></label></p>
        <p><label for="scad"> Scadenza:
          <input type="date" name="scadenza" id="scad" value="2020-12-31" required/></label>
          <label for="cvv"> CVV:
          <input type="number" name="cvv" id="cvv" value="000" maxlength="3" required/></label></p>
        </div>
        <br/>
        <p><label for="acceptTerms-2">
          <input id="acceptTerms-2" name="acceptTerms" type="checkbox" checked class="required">Accetto i <a href="./info_legali.html">Termini e Condizioni.</a>
        </label></p>

      </fieldset>

  	</form>


<script>
var form = $("#form").show();

form.steps({
  headerTag: "h3",
  bodyTag: "fieldset",
  transitionEffect: "slideLeft",
  onStepChanging: function (event, currentIndex, newIndex)
  {
      // Allways allow previous action even if the current form is not valid!
      if (currentIndex > newIndex)
      {
          return true;
      }
      // Forbid next action on "Warning" step if the user is to young
      if (newIndex === 3 && Number($("#age").val()) < 18)
      {
          return false;
      }
      // Needed in some cases if the user went back (clean up)
      if (currentIndex < newIndex)
      {
          // To remove error styles
          form.find(".body:eq(" + newIndex + ") label.error").remove();
          form.find(".body:eq(" + newIndex + ") .error").removeClass("error");
      }
      form.validate().settings.ignore = ":disabled,:hidden";
      return form.valid();
  },
  onStepChanged: function (event, currentIndex, priorIndex)
  {
      // Used to skip the "Warning" step if the user is old enough.
      if (currentIndex === 2 && Number($("#age").val()) >= 18)
      {
          form.steps("next");
      }
      // Used to skip the "Warning" step if the user is old enough and wants to the previous step.
      if (currentIndex === 2 && priorIndex === 3)
      {
          form.steps("previous");
      }
  },
  onFinishing: function (event, currentIndex)
  {
      form.validate().settings.ignore = ":disabled";
      return form.valid();
  },
  onFinished: function (event, currentIndex)
  {
      //ALLA PRESSIONE DEL PULSANTE FINISH
      //pulisco il campo confirm perchè non venga inviata la copia della password in chiaro
      document.getElementById("confirm").value = "";
      //LA FUNZIONE QUI SOTTO FA L'HASHING E INVIA IL FORM
      formhash(document.getElementById("form"),document.getElementById("pw"));
  }
}).validate({
  errorPlacement: function errorPlacement(error, element) { element.before(error); },
  rules: {
      //confirm deve essere uguale alla password pw
      confirm: {
          equalTo: "#pw"
      }
  }
});
</script>



<script>
  function initMap() {

    //SEZIONE AUTOCOMPLETE
    var autocomplete = new google.maps.places.Autocomplete(document.getElementById('indir'));

    autocomplete.setTypes(['address']);
    autocomplete.setComponentRestrictions(
      {
        country: 'IT'
        //postalCode: '47923'
      });

    //se true i suggerimenti sono esclusivamente delle restrizioni
    autocomplete.setOptions({strictBounds: false});

    // Bind the map's bounds (viewport) property to the autocomplete object,
    // so that the autocomplete requests use the current map bounds for the
    // bounds option in the request.
    //suggerimenti in base alla mappa
    //autocomplete.bindTo('bounds', map);

    autocomplete.addListener('place_changed', function() {

      var place = autocomplete.getPlace();
      if (!place.geometry) {
        // User entered the name of a Place that was not suggested and
        // pressed the Enter key, or the Place Details request failed.
        window.alert("No details available for input: '" + place.name + "'");
        return;
      }


      var address = '';
      if (place.address_components) {
        address = [
          (place.address_components[0] && place.address_components[0].short_name || ''),
          (place.address_components[1] && place.address_components[1].short_name || ''),
          (place.address_components[2] && place.address_components[2].short_name || '')
        ].join(' ');
      }

    });


  }
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBinnhjlVy7a2RxTETHiw0LrCByGnrZKnQ&libraries=places&callback=initMap" async defer></script>
  </body>

</html>
